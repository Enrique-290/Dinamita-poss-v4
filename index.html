<!doctype html><meta charset="utf-8">
<title>Dinamita Admin – Acceso</title>
<link rel="stylesheet" href="styles.css">
<div class="login-wrap">
  <div class="login-card">
    <div class="brand">DINAMITA • ADMIN</div>
    <h1>Acceso administrativo</h1>
    <p class="muted">Login real con Firebase. Solo para personal autorizado.</p>
    <form id="loginForm">
      <input id="email" type="email" placeholder="correo" required>
      <input id="password" type="password" placeholder="contraseña" required>
      <button class="btn" type="submit">Entrar</button>
      <div id="err" class="error" style="display:none"></div>
    </form>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
import { firebaseConfig, allowedAdmins } from "./firebase-config.js";

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

const form = document.getElementById('loginForm');
const err = document.getElementById('err');

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  err.style.display='none';
  const email = (document.getElementById('email').value||'').trim().toLowerCase();
  const pass  = document.getElementById('password').value;
  try{
    const { user } = await signInWithEmailAndPassword(auth, email, pass);
    if(!allowedAdmins.includes((user.email||'').toLowerCase())){
      await signOut(auth);
      throw new Error("Este usuario no está autorizado.");
    }
    location.href = 'dashboard.html';
  }catch(e){
    err.textContent = (e.message||'Error de acceso');
    err.style.display='block';
  }
});

// Si ya está logueado y es admin, redirige al dashboard
onAuthStateChanged(auth, (user)=>{
  if(user && allowedAdmins.includes((user.email||'').toLowerCase())){
    location.href = 'dashboard.html';
  }
});
</script>
